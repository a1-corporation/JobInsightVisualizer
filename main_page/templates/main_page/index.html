<!DOCTYPE html>
<html lang="ko">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobInsightVisualizer Main Page</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">

    <!-- CSS 경로 수정 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-3d"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- 추가된 부분 -->
    <script src="{% static 'script2_1.js' %}"></script>
    <script src="{% static 'script3_1.js' %}"></script> <!-- 수정된 파일 -->
    <script src="{% static 'script4.js' %}"></script>

    <script>
        function showChart(chartNumber) {
            const charts = document.querySelectorAll('.chart-content');
            charts.forEach(chart => {
                chart.style.display = 'none';
            });

            const selectedChart = document.getElementById('chart-' + chartNumber);
            if (selectedChart) {
                selectedChart.style.display = 'block';
                // 이미지 소스에 캐시 방지 파라미터 추가
                const img = selectedChart.querySelector('img');
                    if (img) {
                        const timestamp = new Date().getTime(); // 현재 시간을 기반으로 한 타임스탬프
                        img.src = img.src.split('?')[0] + '?t=' + timestamp; // 기존 URL에 타임스탬프 추가
                        console.log(img.src)
                    }
            }

            if (chartNumber === 2) {
                //클릭했을때 그려주는 것으로 변경 
            }
            
            else if (chartNumber == 3) {
                fetchChartData();
            }
            
            else if (chartNumber == 4) {
                console.log("{% static chart_path %}");
                // 여기도 
                drawChart();
                drawChart2();
            } 
            
            else if (chartNumber == 4) {
                // drawChart4
                drawProgrammingChart();
            }

        }
        function showSubChart(subChartNumber) {
            const subCharts = document.querySelectorAll('.sub-chart');
            subCharts.forEach(chart => {
                chart.style.display = 'none';
            });

            const selectedSubChart = document.getElementById('sub-chart-' + subChartNumber);
            if (selectedSubChart) {
                selectedSubChart.style.display = 'block';
            }
        }
    </script>
</head>

<body>
    <header>
        <h1> JobInsightVisualizer Main Page </h1>
    </header>

    <nav>
        <button onclick="showChart(1)"> 직무별 채용공고 분석 그래프 </button>
        <button onclick="showChart(2)"> 지역별 채용공고로 신입/경력 비중 나타내는 시각화 </button>
        <button onclick="showChart(3)"> 직군별 필요 스택을 %로 표현한 것 </button>
        <button onclick="showChart(4)"> 프로그래밍 언어 기준 해당 언어를 많이 쓰는 직업 Top 3 </button>
        <button onclick="showChart(5)"> 특정 기술 스택이 어떤 기술 스택과 연관되는지 </button>
    </nav>

    <main>
        <div id="chart-1" class="chart-content" style="display:none;">
            <h2> 직무별 채용공고 분석 그래프 </h2>

            <button onclick="showSubChart(1)"> 전체 보기 </button>
            <button onclick="showSubChart(2)"> 신입/경력 보기 </button>

            <div id="sub-chart-1" class="sub-chart" style="display:none;">
                <img src="{% url 'job_postings_count_chart' %}" alt="전체 (막대)" />
            </div>
            <div id="sub-chart-2" class="sub-chart" style="display:none;">
                <img src="{% url 'job_postings_count_by_experience_chart' %}" alt="신입/경력 (막대)" />
            </div>
        </div>
        <div id="chart-2" class="chart-content" style="display:none;">
            <!-- <h2>지역별 채용공고로 신입/경력 비중 나타내는 시각화</h2>
            <canvas id="myChart1" width="400" height="200"></canvas>

            <h2>지역별 채용공고로 신입/경력 비중 나타내는 시각화2</h2>
            <canvas id="myChart2" width="400" height="200"></canvas> -->
            <h2>지역별 채용공고로 신입/경력 비중 나타내는 시각화</h2>
            <img src="{% static 'charts/chart1.png' %}" alt="지역별 신입/경력 비중" style="width:800px; height:auto;">


        </div>
        <div id="chart-3" class="chart-content" style="display:none;">
            <h2 id="chart-title">직군별 필요 스택을 %로 표현한 것</h2>
            <select id="job-dropdown" onchange="showJobChart(this.value)">
                <option value="" disabled selected>직업 목록</option>
            </select>
            <div id="treemap-container">
                <div style="display: flex; align-items: center; margin-bottom: 5px;">
                    <div id="entry-treemap-title" style="font-weight: bold; font-size: 16px;">신입</div>
                    <div id="entry-treemap" style="width: 800px; height: 400px; margin-left: 10px;"></div>
                </div>
        
                <div style="display: flex; align-items: center; margin-top: 20px;">
                    <div id="experienced-treemap-title" style="font-weight: bold; font-size: 16px;">경력</div>
                    <div id="experienced-treemap" style="width: 800px; height: 400px; margin-left: 10px;"></div>
                </div>
            </div>
            <!-- <canvas id="treemapCanvas" width="800" height="400"></canvas> -->
            <!-- <img src="{% url 'entry_tech_stacks_chart' %}" alt="신입 (트리맵)" style="display: inline-block; margin-right: 10px;"/>
            <img src="{% url 'experienced_tech_stacks_chart' %}" alt="경력 (트리맵)" style="display: inline-block; margin-right: 10px;" /> -->
        </div>
        <div id="chart-4" class="chart-content" style="display:none;">
            <h2>프로그래밍 언어 기준 해당 언어를 많이 쓰는 직업 Top 3</h2>
            <img src="{% static 'charts/programming_chart.png' %}" alt="Programming Chart">
            <canvas id="myChart4" width="800" height="400"></canvas>
        </div>

        <div id="chart-5" class="chart-content" style="display:none;">
            <h2>특정 기술 스택이 어떤 기술 스택과 연관되는지</h2>
            <ul>
                <li>차트</li>
            </ul>
        </div>
    </main>
</body>

</html>